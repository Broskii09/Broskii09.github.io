<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OMJN — Operator</title>
    <link rel="stylesheet" href="./app.css" />
</head>
<body class="operatorPage">
    <div class="container">
        <!-- LEFT: Queue -->
        <div class="card" id="leftCard">
            <div class="cardHeader">
                <h2>Operator — Queue</h2>
                <div class="row">
                    <a class="btn small" href="./viewer.html" target="_blank" rel="noopener">Open Viewer</a>
                    <a class="btn small" href="./soundboard.html" target="_blank" rel="noopener">Soundboard</a>
<button class="btn small" id="btnExport">Export JSON</button>
                    <label class="btn small" for="importFile" style="cursor:pointer;">Import JSON</label>
                    <input id="importFile" type="file" accept="application/json" hidden />
                    <button class="btn small danger" id="btnReset">New Show</button>
                    <button class="btn small" id="btnSettings">Settings</button>
                </div>
            </div>

            <div class="cardBody">
                <div class="row" style="margin-bottom:10px;">
                    <div class="field" style="flex:1 1 260px;">
                        <label>Show Title</label>
                        <input id="showTitle" type="text" placeholder="Open Mic &amp; Jam Night" autocomplete="off" />
                    </div>
                    <div class="field" style="flex:1 1 340px;">
                        <label>Enter URL of Custom Background Image</label>
                        <input id="splashPath" type="text" placeholder="Paste URL here." autocomplete="off" />
                    </div>
                </div>

                <!-- Always-visible status banner -->
                <div class="statusBanner" id="statusBanner"></div>

                <div class="tabs" style="margin-bottom:12px;">
                    <button class="tabBtn active" id="tabBtnPerformers" type="button">Performers</button>
                    <button class="tabBtn" id="tabBtnHouseBand" type="button">House Band</button>
                    <span class="tabsSpacer"></span>
                    <label class="small" style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="toggleHBFooter" />
                        <span>HB Footer</span>
                    </label>
                    <select id="hbFooterFormat" title="HB Footer format" style="width:auto; padding:6px 10px; border-radius:999px; font-weight:900; font-size:12px;">
                        <option value="categoryFirst">Drums: Mike</option>
                        <option value="nameFirst">Mike (Drums)</option>
                    </select>
                </div>

                <div class="tabPanel" id="tabPerformers">

                <div class="row">
                    <div class="field" style="flex:1 1 240px;">
                        <label>Quick Add Performer</label>
                        <input id="addName" type="text" placeholder="Type name and press Enter" autocomplete="off" list="profileNames" />
                        <datalist id="profileNames"></datalist>
                    </div>

                    <div class="field" style="width:200px;">
                        <label>Slot Type</label>
                        <select id="addType"></select>
                    </div>

                    <div class="field" id="addCustomWrap" style="flex:1 1 240px; display:none;">
                        <label>Custom Slot Label</label>
                        <input id="addCustomLabel" type="text" placeholder="e.g., Trivia, Host Break, Raffle" />
                    </div>

                    <div class="field" id="addCustomMinutesWrap" style="width:140px; display:none;">
                        <label>Minutes</label>
                        <input id="addCustomMinutes" type="number" min="1" step="1" placeholder="15" />
                    </div>

	                    <div class="row" style="gap:10px; align-items:flex-end; padding-top:22px;">
                      <button class="btn good" id="btnAdd" type="button">Add</button>
                      <button class="btn" id="btnAddIntermission" type="button">Intermission</button>
                      <button class="btn" id="btnAddAd" type="button">Ad</button>
                      <button class="btn" id="btnAddHouseBandSlot" type="button">House Band</button>
                    </div>
                </div>

                <hr class="sep" />



                <!-- Settings moved to modal -->
                <div class="queue" id="queue"></div>

                </div>

                <div class="tabPanel" id="tabHouseBand" hidden>
                    <div class="row" style="margin-bottom:10px;">
                        <div class="field" style="flex:1 1 260px;">
                            <label>Quick Add House Band</label>
                            <input id="hbAddName" type="text" placeholder="Name and press Enter" autocomplete="off" />
                        </div>

                        <div class="field" style="width:210px;">
                            <label>Instrument</label>
                            <select id="hbAddInstrument"></select>
                        </div>

                        <div class="field" id="hbAddCustomWrap" style="flex:1 1 240px; display:none;">
                            <label>Custom Instrument</label>
                            <input id="hbAddCustomInstrument" type="text" placeholder="e.g., Sax, Violin" autocomplete="off" />
                        </div>
                    </div>

                    <div class="row" style="margin-bottom:10px;">
                        <div class="field" style="flex:1 1 420px;">
                            <label>Skill Tags (optional)</label>
                            <input id="hbAddTags" type="text" placeholder="comma-separated (e.g., jazz, harmony, keys)" autocomplete="off" />
                        </div>
                        <div class="field" style="width:160px;">
                            <label>&nbsp;</label>
                            <button class="btn" id="btnAddHBQ" type="button">Add</button>
                        </div>
                    </div>

                    <div class="readyStrip" id="readyStrip">
                        <div class="readyCol">
                            <div class="small">Next Up</div>
                            <div class="readyName" id="readyNext">—</div>
                        </div>
                        <div class="readyCol right">
                            <div class="small">On Deck</div>
                            <div class="readyName" id="readyDeck">—</div>
                        </div>
                    </div>

                    <hr class="sep" />

                    <div class="small" style="margin-bottom:10px;">
                        House Band is its own lineup queue by instrument category. Drag to reorder within each category.
                        The <strong>Rotate</strong> button moves that person to the end of their category queue.
                    </div>

                    
                    <div class="hbNav" id="hbNav">
                        <button class="hbNavBtn" type="button" data-hbnav="drums">Drums</button>
                        <button class="hbNavBtn" type="button" data-hbnav="vocals">Vocals</button>
                        <button class="hbNavBtn" type="button" data-hbnav="keys">Keys</button>
                        <button class="hbNavBtn" type="button" data-hbnav="guitar">Guitar</button>
                        <button class="hbNavBtn" type="button" data-hbnav="bass">Bass</button>
                        <button class="hbNavBtn" type="button" data-hbnav="percussion">Percussion</button>
                        <button class="hbNavBtn" type="button" data-hbnav="other">Other</button>
                    </div>

                    <div class="hbCats hbAccWrap" id="hbCats">

                        <details class="hbAcc" data-hbcat="drums" open>
                            <summary class="hbAccSummary">
                                <span class="hbAccTitle">Drums</span>
                                <span class="hbAccCount" id="hbCount_drums"></span>
                                <button class="btn tiny hbRotateTopBtn" type="button" data-rotate-top="drums" title="Rotate top of drums">Rotate top</button>
                                <span class="hbAccChev" aria-hidden="true"></span>
                            </summary>
                            <div class="queue hbCatList" id="hbCat_drums" data-hbcat="drums"></div>
                        </details>

                        <details class="hbAcc" data-hbcat="vocals">
                            <summary class="hbAccSummary">
                                <span class="hbAccTitle">Vocals</span>
                                <span class="hbAccCount" id="hbCount_vocals"></span>
                                <button class="btn tiny hbRotateTopBtn" type="button" data-rotate-top="vocals" title="Rotate top of vocals">Rotate top</button>
                                <span class="hbAccChev" aria-hidden="true"></span>
                            </summary>
                            <div class="queue hbCatList" id="hbCat_vocals" data-hbcat="vocals"></div>
                        </details>

                        <details class="hbAcc" data-hbcat="keys">
                            <summary class="hbAccSummary">
                                <span class="hbAccTitle">Keys</span>
                                <span class="hbAccCount" id="hbCount_keys"></span>
                                <button class="btn tiny hbRotateTopBtn" type="button" data-rotate-top="keys" title="Rotate top of keys">Rotate top</button>
                                <span class="hbAccChev" aria-hidden="true"></span>
                            </summary>
                            <div class="queue hbCatList" id="hbCat_keys" data-hbcat="keys"></div>
                        </details>

                        <details class="hbAcc" data-hbcat="guitar">
                            <summary class="hbAccSummary">
                                <span class="hbAccTitle">Guitar</span>
                                <span class="hbAccCount" id="hbCount_guitar"></span>
                                <button class="btn tiny hbRotateTopBtn" type="button" data-rotate-top="guitar" title="Rotate top of guitar">Rotate top</button>
                                <span class="hbAccChev" aria-hidden="true"></span>
                            </summary>
                            <div class="queue hbCatList" id="hbCat_guitar" data-hbcat="guitar"></div>
                        </details>

                        <details class="hbAcc" data-hbcat="bass">
                            <summary class="hbAccSummary">
                                <span class="hbAccTitle">Bass</span>
                                <span class="hbAccCount" id="hbCount_bass"></span>
                                <button class="btn tiny hbRotateTopBtn" type="button" data-rotate-top="bass" title="Rotate top of bass">Rotate top</button>
                                <span class="hbAccChev" aria-hidden="true"></span>
                            </summary>
                            <div class="queue hbCatList" id="hbCat_bass" data-hbcat="bass"></div>
                        </details>

                        <details class="hbAcc" data-hbcat="percussion">
                            <summary class="hbAccSummary">
                                <span class="hbAccTitle">Percussion</span>
                                <span class="hbAccCount" id="hbCount_percussion"></span>
                                <button class="btn tiny hbRotateTopBtn" type="button" data-rotate-top="percussion" title="Rotate top of percussion">Rotate top</button>
                                <span class="hbAccChev" aria-hidden="true"></span>
                            </summary>
                            <div class="queue hbCatList" id="hbCat_percussion" data-hbcat="percussion"></div>
                        </details>

                        <details class="hbAcc" data-hbcat="other">
                            <summary class="hbAccSummary">
                                <span class="hbAccTitle">Other</span>
                                <span class="hbAccCount" id="hbCount_other"></span>
                                <button class="btn tiny hbRotateTopBtn" type="button" data-rotate-top="other" title="Rotate top of other">Rotate top</button>
                                <span class="hbAccChev" aria-hidden="true"></span>
                            </summary>
                            <div class="queue hbCatList" id="hbCat_other" data-hbcat="other"></div>
                        </details>

                    </div>
                </div>

            </div>
        </div>

        <!-- RIGHT: Now / Next / Edit -->
        <div class="rightGrid">

            <div class="card">
                <div class="cardHeader">
                    <h2>Live Control</h2>
                    </div>
                <div class="cardBody">
                    <div class="kpi">
                        <div>
                            <div class="label">Current</div>
                            <div class="value" id="kpiCurrent">—</div>
                        </div>
                        <div>
                            <div class="label">Next</div>
                            <div class="value" id="kpiNext">—</div>
                        </div>
                        <div>
                            <div class="label">Left</div>
                            <div class="value" id="kpiLeft">—</div>
                        </div>
                        <div>
                            <div class="label">Est End</div>
                            <div class="value" id="kpiEstEnd">—</div>
                        </div>
                    </div>

                    <div class="statusBanner liveStatusBanner" id="liveStatusBanner">
                        <span class="sbItem"><span class="sbDot" id="livePhaseDot" aria-hidden="true"></span><span class="mono" id="statusLine">SPLASH</span></span>
                        <span class="sbItem" id="liveNowItem" hidden>Now: <span class="mono" id="liveNowName">—</span></span>
                        <span class="sbItem" id="liveOTItem" hidden>Overtime: <span class="mono" id="liveOTVal">+0:00</span></span>
                    </div>

                    <div class="readyStrip">
                        <div class="readyCol">
                            <div class="small">Next Up</div>
                            <div class="readyName">—</div>
                        </div>
                        <div class="readyCol right">
                            <div class="small">On Deck</div>
                            <div class="readyName">—</div>
                        </div>
                    </div>

                    <hr class="sep" />

                    <div class="row">
                        <button class="btn primary" id="btnStart">Start</button>
                        <button class="btn" id="btnPause">Pause</button>
                        <button class="btn" id="btnResume">Resume</button>
                        <button class="btn danger" id="btnEnd">End → Splash</button>
                        <button class="btn" id="btnUndo" title="Undo (Ctrl+Z)">Undo</button>
                        <button class="btn" id="btnRedo" title="Redo (Ctrl+Shift+Z)">Redo</button>
                        <button class="btn" id="btnExportState" title="Export show state (JSON)">Export</button>
                        <button class="btn" id="btnImportState" title="Import show state (JSON)">Import</button>
                        <input type="file" id="importStateFile" accept="application/json" style="display:none;" />
                    </div>

                    <hr class="sep">

                    <div class="row" style="margin-top:10px; justify-content:flex-start;">
                        <button class="btn tiny" id="btnMinus30">-:30</button>
                        <button class="btn tiny" id="btnPlus30">+:30</button>
                        <button class="btn tiny" id="btnMinus1">-1m</button>
                        <button class="btn tiny" id="btnMinus5">-5m</button>
                        <button class="btn tiny" id="btnPlus1">+1m</button>
                        <button class="btn tiny" id="btnPlus5">+5m</button>
                        <button class="btn tiny" id="btnResetTime">Reset Time</button>
                    </div>


                    <div style="margin-top:10px;">
                        <div class="timerSub">Elapsed / Remaining</div>
                        <div class="timerBig mono" id="timerLine">0:00 / 0:00</div>
                        <div class="small" id="timerHint">Hard stop at 0:00. Overtime shown on viewer.</div>
                    </div>
                </div>
            </div>
        <div class="card" id="crowdPromptCard">
            <div class="cardHeader">
                <h2>Crowd Prompts</h2>

                <div class="crowdStatusStrip" id="crowdStatusStrip" aria-live="polite">
                    <span class="pill off" id="crowdStatusPill">OFF</span>
                    <span class="mono crowdStatusName" id="crowdStatusName">—</span>
                    <span class="mono crowdStatusMeta" id="crowdStatusMeta">—</span>
                    <span class="mono crowdStatusMeta" id="crowdStatusAutoHide">Auto-hide: —</span>
                    <span class="pill draft" id="crowdDraftBadge" hidden>DRAFT</span>
                </div>
            </div>

            <div class="cardBody">
                <div class="row crowdControlsRow" style="gap:8px; justify-content:flex-start; align-items:center;">
                    <button class="btn tiny" id="btnCrowdPrev" title="Previous crowd prompt">◀</button>
                    <button class="btn tiny" id="btnCrowdToggle" title="Toggle crowd prompt">Crowd: Off</button>
                    <button class="btn tiny" id="btnCrowdNext" title="Next crowd prompt">▶</button>

                    <div class="spacer"></div>

                    <button class="btn tiny" id="btnCrowdEditToggle" type="button" title="Edit the currently selected preset">
                        Edit preset
                    </button>
                </div>

                <div class="crowdPromptGrid">
                    <div class="crowdPromptEditorCol">
                        <div class="crowdEditorClosedHint" id="crowdEditorClosedHint">
                            <div class="mono" style="font-weight:900; letter-spacing:.2px;">Edit the selected prompt</div>
                            <div class="small" style="opacity:.85; margin-top:4px;">
                                Change title, lines, footer, and auto-hide. Use the preview on the right to see what viewers will see.
                            </div>
                        </div>

                        <div class="crowdEditorPanel" id="crowdEditorPanel" hidden>
                            <div class="row wrap" style="align-items:flex-end;">
                                <div class="field" style="flex:1 1 240px;">
                                    <label>Preset name (operator only)</label>
                                    <input id="crowdPresetName" type="text" autocomplete="off" />
                                </div>
                                <div class="field" style="flex:1 1 240px;">
                                    <label>Title</label>
                                    <input id="crowdTitle" type="text" autocomplete="off" />
                                </div>
                                <div class="field" style="width:170px;">
                                    <label>Auto-hide (sec)</label>
                                    <input id="crowdAutoHide" type="number" min="0" max="60" step="1" />
                                    <div class="small" style="opacity:.8;">0 = off</div>
                                </div>
                            </div>

                            <div class="field">
                                <label>Lines (one per line)</label>
                                <textarea id="crowdLines" rows="6" placeholder="One line per rule / prompt"></textarea>
                            </div>

                            <div class="row wrap" style="align-items:flex-end;">
                                <div class="field" style="flex:1 1 320px;">
                                    <label>Footer (optional)</label>
                                    <input id="crowdFooter" type="text" autocomplete="off" />
                                </div>
                                <div class="spacer"></div>

                                <button class="btn small" id="btnCrowdCancel" type="button">Cancel</button>
                                <button class="btn small primary" id="btnCrowdSave" type="button">Save</button>
                            </div>

                            <details class="crowdAdv" id="crowdAdv">
                                <summary class="small">Manage presets</summary>
                                <div class="row wrap" style="align-items:flex-end; margin-top:10px;">
                                    <button class="btn small" id="btnCrowdAdd" type="button">Add</button>
                                    <button class="btn small" id="btnCrowdDuplicate" type="button">Duplicate</button>
                                    <button class="btn small danger" id="btnCrowdDelete" type="button">Delete</button>
                                </div>
                            </details>
                        </div>

                        <div class="small crowdPromptHelp">
                            Show-control interstitial overlays (House Rules + hype prompts). Prompts hide the sponsor bug while active.
                        </div>
                    </div>

                    <div class="crowdPromptPreviewCol">
                        <div class="small" style="margin-bottom:6px; opacity:.85;">Viewer Preview</div>
                        <div class="crowdPromptPreview" id="crowdPromptPreview" aria-label="Crowd prompt preview"></div>
                    </div>
                </div>
            </div>
        </div>

            
        </div>
    </div>



        <div class="modalOverlay" id="settingsModal" hidden>
        <div class="modalPanel settingsPanelShell" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
            <div class="modalHeader">
                <div class="modalTitle">
                    <h2 id="settingsTitle">Settings</h2>
                    <div class="small">Viewer · Timer · Visualizer · Crowd · Advanced</div>
                </div>
                <div class="modalActions">
                    <button class="btn small" id="btnCloseSettings" type="button">Close</button>
                </div>
            </div>
            <div class="modalBody">
                <div class="cardBody">

                    <div class="settingsTabs">
                        <div class="settingsNav" role="tablist" aria-label="Settings sections">
                            <button class="settingsTabBtn isActive" type="button" data-tab="viewer" aria-selected="true">Viewer</button>
                            <button class="settingsTabBtn" type="button" data-tab="timer" aria-selected="false">Timer</button>
                            <button class="settingsTabBtn" type="button" data-tab="visualizer" aria-selected="false">Visualizer</button>
                            <button class="settingsTabBtn" type="button" data-tab="crowd" aria-selected="false">Crowd</button>
                            <button class="settingsTabBtn" type="button" data-tab="advanced" aria-selected="false">Advanced</button>
                        </div>

                        <div class="settingsPanels">
                            <section class="settingsPanel" data-panel="viewer">
<h3 class="subhead">Theme</h3>
                    <div class="row wrap">
                        <div class="field" style="flex:1 1 180px;">
                            <label>Background</label>
                            <input id="setBgColor" type="color" />
                        </div>
                        <div class="field" style="flex:1 1 180px;">
                            <label>Panel</label>
                            <input id="setPanelColor" type="color" />
                        </div>
                        <div class="field" style="flex:1 1 180px;">
                            <label>Accent</label>
                            <input id="setAccentColor" type="color" />
                        </div>
                        <div class="field" style="flex:1 1 180px;">
                            <label>Text</label>
                            <input id="setTextColor" type="color" />
                        </div>
                    </div>

                    <div class="row wrap" style="margin-top:10px;">
                        <div class="field" style="flex:1 1 180px;">
                            <label>Viewer Card Color</label>
                            <input id="setCardColor" type="color" />
                        </div>
                        <div class="field" style="flex:1 1 240px;">
                            <label>Viewer Card Opacity</label>
                            <input id="setCardOpacity" type="range" min="0.50" max="1.00" step="0.01" />
                            <div class="small mono" id="setCardOpacityVal">0.90</div>
                        </div>
                    </div>

                    <h3 class="subhead">Splash</h3>
                    <div class="row wrap" style="align-items:flex-end; margin-bottom:10px;">
                        <span class="pill" title="Show or hide the Next Up / On Deck cards on the SPLASH screen">
                            Next Up / On Deck cards
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="setSplashShowNextTwo" />
                                <span class="small">on</span>
                            </label>
                        </span>
                    </div>

<hr class="sep" />

                    <h3 class="subhead">Sponsor Bug</h3>
                    <div class="small" style="margin-bottom:8px; opacity:.85;">Overlay logo/watermark. Max size is capped by % of the Viewer viewport (tight) to keep layouts safe.</div>

                    <div class="row wrap" style="align-items:flex-end; margin-bottom:10px;">
                        <span class="pill" title="Toggle sponsor bug overlay">
                            Enabled
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="setSponsorEnabled" />
                                <span class="small">on</span>
                            </label>
                        </span>

                        <span class="pill" title="Show sponsor bug only during LIVE (default ON)">
                            LIVE only
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="setSponsorLiveOnly" />
                                <span class="small">on</span>
                            </label>
                        </span>

                        <div class="field" style="width:220px;">
                            <label>Source</label>
                            <select id="setSponsorSourceType">
                                <option value="upload">Upload image</option>
                                <option value="url">URL / Path</option>
                            </select>
                        </div>

                        <div class="spacer"></div>
                        <div class="small mono" id="sponsorBugStatus" style="opacity:.85;">—</div>
                    </div>

                    <div class="row wrap" style="margin-bottom:10px;">
                        <div class="field" style="flex:1 1 320px;">
                            <label>URL / Path (supports ./assets/logo.png)</label>
                            <input id="setSponsorUrl" type="text" placeholder="./assets/sponsor.png or https://..." autocomplete="off" />
                        </div>

                        <div class="field" style="width:260px;">
                            <label>Upload</label>
                            <div class="row" style="gap:8px;">
                                <label class="btn small" for="setSponsorUploadFile" style="cursor:pointer; flex:0 0 auto;">Choose</label>
                                <input id="setSponsorUploadFile" type="file" accept="image/*" hidden />
                                <button class="btn small" id="btnClearSponsorUpload" type="button">Clear</button>
                            </div>
                        </div>

                        <div class="field" style="width:180px;">
                            <label>Preview</label>
                            <img id="sponsorBugPreview" alt="" style="width:100%; height:70px; object-fit:contain; border-radius:16px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.20);" />
                        </div>
                    </div>

                    <div class="row wrap">
                        <div class="field" style="width:170px;">
                            <label>Position</label>
                            <select id="setSponsorPosition">
                                <option value="TL">Top Left</option>
                                <option value="TR">Top Right</option>
                                <option value="BL">Bottom Left</option>
                                <option value="BR">Bottom Right</option>
                            </select>
                        </div>

                        <div class="field" style="flex:1 1 240px;">
                            <label>Scale</label>
                            <input id="setSponsorScale" type="range" min="0.25" max="2" step="0.05" />
                            <div class="small mono" id="setSponsorScaleVal">1.00×</div>
                        </div>

                        <div class="field" style="flex:1 1 240px;">
                            <label>Max size (% of viewport)</label>
                            <input id="setSponsorMaxPct" type="range" min="5" max="25" step="1" />
                            <div class="small mono" id="setSponsorMaxPctVal">18%</div>
                        </div>

                        <div class="field" style="flex:1 1 240px;">
                            <label>Opacity</label>
                            <input id="setSponsorOpacity" type="range" min="0" max="1" step="0.01" />
                            <div class="small mono" id="setSponsorOpacityVal">1.00</div>
                        </div>

                        <div class="field" style="flex:1 1 240px;">
                            <label>Safe margin (px)</label>
                            <input id="setSponsorSafeMargin" type="range" min="0" max="200" step="1" />
                            <div class="small mono" id="setSponsorSafeMarginVal">16px</div>
                        </div>
                    </div>
</section>

                            <section class="settingsPanel" data-panel="timer" hidden>

                    <h3 class="subhead">Timer</h3>
                    <div class="row wrap" style="align-items:flex-end; margin-bottom:10px;">
                        <span class="pill" title="Show the progress bar under the main timer">
                            Progress bar
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="setShowProgressBar" />
                                <span class="small">on</span>
                            </label>
                        </span>
                        <span class="pill" title="Show the overtime chip after the timer hits 0:00">
                            Overtime chip
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="setShowOvertime" />
                                <span class="small">on</span>
                            </label>
                        </span>
                    </div>

                    <div class="row wrap" style="margin-bottom:10px;">
                        <div class="field" style="flex:1 1 220px;">
                            <label>Warn pulse starts at (sec remaining)</label>
                            <input id="setWarnAtSec" type="number" min="0" max="600" step="5" />
                            <div class="small mono" id="setWarnAtSecVal">2:00</div>
                        </div>
                        <div class="field" style="flex:1 1 220px;">
                            <label>Final pulse starts at (sec remaining)</label>
                            <input id="setFinalAtSec" type="number" min="0" max="600" step="5" />
                            <div class="small mono" id="setFinalAtSecVal">0:30</div>
                        </div>
                    </div>

                    <hr class="sep" />

<h3 class="subhead">Viewer time cues</h3>
                    <div class="row wrap">
                        <div class="field" style="flex:1 1 180px;">
                            <label>2:00 Pulse Color</label>
                            <input id="setWarnColor" type="color" />
                        </div>
                        <div class="field" style="flex:1 1 220px;">
                            <label>2:00 Pulse Speed (sec)</label>
                            <input id="setWarnSpeed" type="number" min="0.6" step="0.1" />
                        </div>
                        <div class="field" style="flex:1 1 240px;">
                            <label>2:00 Pulse Opacity</label>
                            <input id="setWarnAlpha" type="range" min="0" max="1" step="0.01" />
                            <div class="small mono" id="setWarnAlphaVal">0.12</div>
                        </div>

                        <div class="field" style="flex:1 1 180px;">
                            <label>0:30 Pulse Color</label>
                            <input id="setFinalColor" type="color" />
                        </div>
                        <div class="field" style="flex:1 1 220px;">
                            <label>0:30 Pulse Speed (sec)</label>
                            <input id="setFinalSpeed" type="number" min="0.4" step="0.1" />
                        </div>
                        <div class="field" style="flex:1 1 240px;">
                            <label>0:30 Pulse Opacity</label>
                            <input id="setFinalAlpha" type="range" min="0" max="1" step="0.01" />
                            <div class="small mono" id="setFinalAlphaVal">0.18</div>
                        </div>
                        <div class="field" style="flex:1 1 180px;">
                            <label>Overtime Flash Color</label>
                            <input id="setOvertimeColor" type="color" />
                        </div>
                    </div>
                    <div class="field" style="flex:1 1 240px;">
                        <label>Overtime Flash Opacity</label>
                        <input id="setOvertimeAlpha" type="range" min="0" max="1" step="0.01" />
                        <div class="small mono" id="setOvertimeAlphaVal">0.85</div>
                    </div>

                    <hr class="sep" />

                    <h3 class="subhead">Slot types</h3>
                    <div class="small" style="margin-bottom:8px;">Defaults for new signups. You can still override minutes per performer.</div>
                    <div id="slotTypesEditor" class="slotTypesEditor"></div>
</section>

                            <section class="settingsPanel" data-panel="visualizer" hidden>
<h3 class="subhead">Audio visualizer</h3>
                    <div class="row wrap">
                        <span class="pill" title="Mic-based visualizer shown during LIVE only">
                            Audio visualizer
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="setVizEnabled" />
                                <span class="small">on</span>
                            </label>
                        </span>
                        <div class="field" style="flex:1 1 320px;">
                            <label>Sensitivity (start at 1.0×)</label>
                            <input id="setVizSensitivity" type="range" min="0.25" max="4" step="0.05" />
                            <div class="small mono" id="setVizSensitivityVal">1.00×</div>
                        </div>
                        
                        <div class="field" style="flex:1 1 220px;">
                            <label>Visualizer type</label>
                            <select id="setVizMode">
                                <option value="eq">EQ (music-style)</option>
                                <option value="volume">Volume (simple bounce)</option>
                            </select>
                        </div>
                        <div class="field" style="flex:1 1 220px;">
                            <label>Direction</label>
                            <select id="setVizDirection">
                                <option value="mirror">Mirror (from center)</option>
                                <option value="ltr">Left to right</option>
                            </select>
                        </div>
                        <div class="small" style="opacity:.85;">Tip: open the Viewer once before showtime and click “Enable Mic Visualizer” if your browser asks.</div>
                    </div>
                            </section>

                            <section class="settingsPanel" data-panel="crowd" hidden>
                    <h3 class="subhead">Crowd Prompts</h3>
                    <div class="small" style="margin-bottom:10px; opacity:.9;">
                      Crowd Prompts are full-screen messages (House Rules, CHEER, etc.) shown on the Viewer.
                      You can turn them on/off with the Crowd buttons on the main Operator screen.
                    </div>
                    <div class="row wrap" style="gap:12px; align-items:flex-end; margin: 8px 0 14px;">
  <span class="pill" title="Turns the selected Crowd Prompt ON/OFF on the Viewer">
    Enabled
    <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
      <input type="checkbox" id="setCrowdEnabled" />
      <span class="small">on</span>
    </label>
  </span>

  <div class="field" style="flex:1 1 260px; min-width:220px;">
    <label>Preset</label>
    <select id="setCrowdPreset"></select>
  </div>

  <button class="btn small good" id="btnCrowdShowNow" type="button" title="Show the selected prompt now">Show now</button>
  <button class="btn small" id="btnCrowdHide" type="button" title="Hide crowd prompt">Hide</button>

  <div class="small" id="crowdPromptStatus" style="opacity:.85;"></div>
</div>

<div class="row wrap" style="align-items:center;">
                      <button class="btn small" id="btnSettingsOpenCrowdEditor" type="button">Open Crowd Prompt Editor</button>
                      <div class="small" style="opacity:.85;">Tip: edit presets + auto-hide time there.</div>
                    </div>
                            </section>

                            <section class="settingsPanel" data-panel="advanced" hidden>
<h3 class="subhead">Safety & hotkeys</h3>
                    <div class="row" style="margin-bottom:10px;">
                        <span class="pill" title="Prevents accidental starts">
                            Start Confirm
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="startGuard" />
                                <span class="small">on</span>
                            </label>
                        </span>

                        <span class="pill" title="Prevents accidental end-to-splash while live">
                            End Confirm
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="endGuard" />
                                <span class="small">on</span>
                            </label>
                        </span>

                        <span class="pill" title="Keyboard shortcuts for fast hosting">
                            Hotkeys
                            <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                <input type="checkbox" id="hotkeysEnabled" />
                                <span class="small">on</span>
                            </label>
                        </span>
                        <div class="spacer"></div>
                        <div class="small">Shortcuts: Space Start/Pause/Resume · N End · Ctrl+Z Undo</div>
                    </div>

                    <hr class="sep" />

                    <h3 class="subhead">Backup</h3>
                    <div class="row">
                        <button class="btn small" id="btnExportSettings">Export Settings</button>
                        <label class="btn small" for="importSettingsFile" style="cursor:pointer;">Import Settings</label>
                        <input id="importSettingsFile" type="file" accept="application/json" hidden />
                        <button class="btn small danger" id="btnResetSettings">Reset Settings</button>
                        <div class="spacer"></div>
                        <div class="small">Move your theme and slot defaults to a new computer.</div>
                    </div>
                            </section>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

<div class="modalOverlay" id="timerUpModal" hidden>
        <div class="modalPanel timerUpPanel" role="dialog" aria-modal="true" aria-labelledby="timerUpTitle">
            <div class="modalHeader timerUpHeader">
                <div class="modalTitle">
                    <h2 id="timerUpTitle">Time’s up</h2>
                    <div class="small" id="timerUpSubtitle">Prompting you to transition cleanly.</div>
                </div>
                <div class="modalActions">
                    <button class="btn small" id="btnTimerUpDismiss" type="button" title="Dismiss for this timer run">Dismiss</button>
                </div>
            </div>
            <div class="modalBody">
                <div class="timerUpBody">
                    <div class="timerUpName mono" id="timerUpName">—</div>
                    <div class="timerUpOver mono" id="timerUpOver">Overtime: +0:00</div>

                    <div class="row wrap" style="gap:10px; margin-top:14px;">
                        <button class="btn danger" id="btnTimerUpEnd" type="button">End → Splash</button>
                        <button class="btn" id="btnTimerUpPause" type="button">Pause</button>
                        <button class="btn" id="btnTimerUpResume" type="button">Resume</button>
                        <button class="btn" id="btnTimerUpSnooze" type="button" title="Remind me again in 30 seconds">Snooze 30s</button>
                    </div>

                    <hr class="sep" />

                    <div class="row" style="gap:8px; justify-content:flex-start;">
                        <button class="btn tiny" id="btnTimerUpPlus30" type="button">+:30</button>
                        <button class="btn tiny" id="btnTimerUpPlus1" type="button">+1m</button>
                        <button class="btn tiny" id="btnTimerUpPlus5" type="button">+5m</button>
                        <button class="btn tiny" id="btnTimerUpReset" type="button">Reset Time</button>
                    </div>

                    <div class="small" style="margin-top:10px; opacity:.85;">
                        Tip: Use Snooze if you’re waiting for teardown. End → Splash clears the stage and sets you up for the next performer.
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Intermission Builder Modal -->
    <div class="modalOverlay" id="intermissionModal" hidden>
        <div class="modalPanel imBuildPanel" role="dialog" aria-modal="true" aria-labelledby="imTitle">
            <div class="modalHeader">
                <div class="modalTitle">
                    <h2 id="imTitle">Add Intermission</h2>
                    <div class="small">Set a timer + on-screen message</div>
                </div>
                <div class="modalActions">
                    <button class="btn small" id="btnImClose" type="button">Close</button>
                </div>
            </div>
            <div class="modalBody">
                <div class="row wrap" style="gap:12px; align-items:flex-end;">
                    <div class="field" style="flex:1 1 220px;">
                        <label>Title</label>
                        <input id="imName" type="text" placeholder="INTERMISSION" />
                    </div>

                    <div class="field" style="flex:0 0 260px;">
                        <label>Duration</label>
                        <div class="row wrap" style="gap:8px;">
                            <button class="btn tiny" id="imDur5" type="button" data-mins="5">5m</button>
                            <button class="btn tiny" id="imDur10" type="button" data-mins="10">10m</button>
                            <button class="btn tiny" id="imDur15" type="button" data-mins="15">15m</button>
                            <button class="btn tiny" id="imDurCustom" type="button" data-mins="custom">Custom</button>
                        </div>
                        <div class="row" id="imCustomWrap" style="gap:8px; margin-top:8px; display:none;">
                            <input id="imCustomMins" type="number" min="1" step="1" placeholder="Minutes" style="width:120px;" />
                            <div class="small" style="opacity:.85;">min</div>
                        </div>
                    </div>
                </div>

                <div class="field" style="margin-top:12px;">
                    <label>Message on screen</label>
                    <textarea id="imMsg" rows="3" placeholder="WE'LL BE RIGHT BACK"></textarea>
                </div>

                <div class="row" style="justify-content:flex-end; gap:10px; margin-top:14px;">
                    <button class="btn" id="btnImCancel" type="button">Cancel</button>
                    <button class="btn accent" id="btnImAdd" type="button">Add to Queue</button>
                </div>

                <div class="small" style="margin-top:10px; opacity:.85;">
                    Tip: You can edit it later from the queue (Title / Duration / Message).
                </div>
            </div>
        </div>
    </div>


        <!-- Graphic Ad Builder Modal -->
    <div class="modalOverlay" id="adModal" hidden>
        <div class="modalPanel" style="max-width:820px;" role="dialog" aria-modal="true" aria-labelledby="adModalTitle">
            <div class="modalHeader">
                <div class="modalTitle">
                    <h2 id="adModalTitle">Graphic Ad</h2>
                    <div class="small" id="adModalSub">Full-screen on the viewer while LIVE.</div>
                </div>
                <div class="modalActions">
                    <button class="btn small" id="btnAdClose" type="button">Close</button>
                </div>
            </div>

            <div class="modalBody">
                <div class="row wrap" style="gap:12px; align-items:flex-end;">
                    <div class="field" style="flex:1 1 260px;">
                        <label for="adLabel">Label</label>
                        <input id="adLabel" type="text" placeholder="Optional label (defaults from preset/file)" />
                    </div>

                    <div class="field" style="flex:0 0 200px;">
                        <label for="adKind">Type</label>
                        <select id="adKind">
                            <option value="graphic">Graphic (Image)</option>
                            <option value="video">Video</option>
                        </select>
                    </div>

                    <div class="field" style="flex:0 0 260px;">
                        <label for="adSource">Source</label>
                        <select id="adSource">
                            <option value="preset">Preset</option>
                            <option value="upload">Upload</option>
                            <option value="url">URL</option>
                        </select>
                    </div>
                </div>

                <div class="row wrap" id="adVideoOptions" style="gap:12px; align-items:center; margin-top:10px; display:none;">
                    <label class="chk"><input type="checkbox" id="adVideoLoop" /> Loop video</label>
                    <label class="chk"><input type="checkbox" id="adVideoAudio" /> Audio on (may require click / autoplay limits)</label>
                </div>

                <div class="field" id="adPresetWrap" style="margin-top:12px; display:none;">
                    <label>Preset ads</label>

                    <!-- Hidden select used for compatibility (selection is driven by list UI) -->
                    <select id="adPreset" style="display:none;"></select>

                    <div class="adPresetTools" style="margin-top:6px;">
                        <input id="adPresetSearch" class="adPresetSearch" type="text" placeholder="Search presets…" autocomplete="off" />
                        <button class="btn tiny" id="btnAdPresetRefresh" type="button">Refresh</button>
                    </div>

                    <div id="adPresetList" class="adPresetList" style="margin-top:8px;"></div>

                    <div class="small muted" id="adPresetStatus" style="margin-top:8px; display:none;"></div>

                    <div class="row wrap" id="adManifestLocalRow" style="gap:10px; align-items:center; margin-top:10px; display:none;">
                        <input id="adManifestFile" type="file" accept="application/json" />
                        <button class="btn tiny" id="btnLoadAdManifest" type="button">Load manifest</button>
                    </div>

                    <div class="small" style="margin-top:8px; opacity:.85;">
                        Loaded from <span class="mono">ads_manifest.json</span> (or <span class="mono">ads_manifest.example.json</span>)
                    </div>
                </div>

                <div class="field" id="adUploadWrap" style="margin-top:12px; display:none;">
                    <label for="adFile">Upload file</label>
                    <input id="adFile" type="file" accept="image/*,video/*" />
                    <div class="small" style="margin-top:8px; opacity:.85;">
                        Stored locally in your browser for this device (IndexedDB).
                    </div>
                </div>

                <div class="field" id="adUrlWrap" style="margin-top:12px; display:none;">
                    <label for="adUrl">Media URL</label>
                    <input id="adUrl" type="text" placeholder="https://... (image or direct mp4/webm)" />
                </div>

                <div class="field" id="adPreviewWrap" style="margin-top:12px; display:none;">
                    <label>Preview</label>
                    <div style="border:1px solid rgba(255,255,255,.12); border-radius:12px; overflow:hidden; background:rgba(0,0,0,.35);">
                        <img id="adPreviewImg" alt="" style="display:none; width:100%; max-height:320px; object-fit:contain;" />
                        <video id="adPreviewVideo" style="display:none; width:100%; max-height:320px; object-fit:contain;" muted playsinline controls></video>
                    </div>
                </div>

                <div class="row" style="justify-content:flex-end; gap:10px; margin-top:14px;">
                    <button class="btn" id="btnAdCancel" type="button">Cancel</button>
                    <button class="btn accent" id="btnAdSave" type="button">Add to Queue</button>
                    <button class="btn good" id="btnAdLive" type="button">Go Live</button>
                </div>

                <div class="small" style="margin-top:10px; opacity:.85;">
                    Tip: Graphic ads have no set duration. When you’re done, hit End → Splash.
                </div>
            </div>
        </div>
    </div>



    <!-- House Band Set Builder Modal -->
    <div class="modalOverlay" id="hbBuildModal" hidden>
        <div class="modalPanel hbBuildPanel" role="dialog" aria-modal="true" aria-labelledby="hbBuildTitle">
            <div class="modalHeader">
                <div class="modalTitle">
                    <h2 id="hbBuildTitle">Build House Band Set</h2>
                    <div class="small" id="hbBuildSubtitle">Pick who’s playing for this set. Suggested players are preselected.</div>
                </div>
                <div class="modalActions">
                    <button class="btn small" id="btnHbBuildClose" type="button">Close</button>
                </div>
            </div>
            <div class="modalBody">
                <div class="hbBuildGrid" id="hbBuildList"></div>

                <div class="hbBuildPreview">
                    <div class="small">Viewer preview</div>
                    <div class="hbPreviewNames" id="hbPreviewNames">—</div>
                    <div class="hbPreviewRoles" id="hbPreviewRoles">—</div>
                </div>

                <div class="row" style="justify-content:space-between; gap:10px; margin-top:14px;">
                    <div class="row" style="gap:8px;">
                        <button class="btn tiny" id="btnHbBuildEnableAll" type="button">Enable all</button>
                        <button class="btn tiny" id="btnHbBuildClearAll" type="button">Clear all</button>
                    </div>
                    <div class="row" style="gap:10px;">
                        <button class="btn" id="btnHbBuildCancel" type="button">Cancel</button>
                        <button class="btn accent" id="btnHbBuildSave" type="button">Add to Queue</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

  <script src="./shared.js"></script>
  <script src="./operator.js"></script>
</body>
</html>
